<!DOCTYPE html>
<meta charset="utf-8">
<html>
 <head>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="d3sparql.js"></script>
  <style type="text/css">
    .arc text {
       font-size: 12px;
       font-family: Helvetica;
    }   
  </style>

  <script>
  function exec() {
    
    var endpoint = "http://localhost:8081/sparql";

    var sparql1 = "\
      SELECT ?place ?population \
      WHERE { \
        ?rsrc <http://gaffer.test/#town-population> ?population . \
        ?rsrc <http://purl.org/dc/elements/1.1/title> ?place . \
        } ORDER BY DESC(?population) LIMIT 20 \
    ";
    d3sparql.query(endpoint, sparql1, render1);

    var sparql2 = "\
      SELECT ?place ?population \
      WHERE { \
        ?rsrc <http://gaffer.test/#town-population> ?population . \
        ?rsrc <http://purl.org/dc/elements/1.1/title> ?place . \
        } ORDER BY DESC(?population) LIMIT 15 \
    ";
    d3sparql.query(endpoint, sparql2, render2);

    var sparql3 = "\
             SELECT ?lat ?long ?place \
             WHERE { \
                 ?rsrc <http://www.w3.org/2003/01/geo/wgs84_pos#lat> ?lat . \
                 ?rsrc <http://www.w3.org/2003/01/geo/wgs84_pos#long> ?long . \
		 ?rsrc <http://purl.org/dc/elements/1.1/title> ?place . \
             } \
    ";
    d3sparql.query(endpoint, sparql3, render3);

  }
  
  function render1(json) {
     var config = {
        "label_x": "Town",
        "label_y": "Area",
        "var_x": "place",
        "var_y": "population",
        "width":  700,  // canvas width
        "height": 300,  // canvas height
        "margin":  80,  // canvas margin
        "selector": "#chart1"
      };
      d3sparql.barchart(json, config);
  }

  function render2(json) {
     var config = {
        "label": "place",
	"size": "population",
	"width": 400,
	"height": 400,
        "hole":  90,
        "selector": "#chart2"
      };
      d3sparql.piechart(json, config);
  }

  function render3(json) {
      var config = {
        "var_lat": "lat",
        "var_lng": "long",
        "width": 500,
        "height": 500,
        "radius": 5,
        "color": "#55C25E",
        "topojson": "lib/d3/map/world-50m.json",
        "selector": "#result"
      };
      d3sparql.coordmap(json, config);
    }
    
</script>
  <style>
  <!-- customize CSS -->
  </style>
 </head>
 <body onload="exec()">
  <form style="display:none">
   <input id="endpoint" value="http://dbpedia.org/sparql" type="text">
   <textarea id="sparql">
    PREFIX ...
    SELECT ...
    WHERE { ... }
   </textarea>
  </form>
  <div id="chart1"></div>
  <div id="chart2"></div>
  <div id="chart3"></div>
 </body>
</html>
